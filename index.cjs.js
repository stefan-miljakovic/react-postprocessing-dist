"use strict";Object.defineProperty(exports,"__esModule",{value:!0});var e=require("postprocessing"),t=require("@babel/runtime/helpers/objectWithoutPropertiesLoose"),r=require("react"),n=require("three"),o=require("@babel/runtime/helpers/extends"),i=require("@babel/runtime/helpers/construct"),u=require("react-three-fiber");function c(e){return e&&"object"==typeof e&&"default"in e?e:{default:e}}var f=c(t),a=c(r),s=c(o),l=c(i),d=function(t,n){return void 0===n&&(n=e.BlendFunction.NORMAL),r.forwardRef((function(e,o){var i=e.blendFunction,u=e.opacity,c=f.default(e,["blendFunction","opacity"]),s=r.useMemo((function(){return new t(c)}),[c]);return r.useLayoutEffect((function(){s.blendMode.blendFunction=i||n,void 0!==u&&(s.blendMode.opacity.value=u)}),[i,s.blendMode,u]),a.default.createElement("primitive",{ref:o,object:s,dispose:null})}))},p=function(e,t){var o=e[t];return r.useMemo((function(){if(o instanceof n.Vector2)return(new n.Vector2).set(o.x,o.y);if(Array.isArray(o)){var e=o[0],t=o[1];return(new n.Vector2).set(e,t)}}),[o])},m=function(){try{var e=document.querySelector("canvas");return!!e&&!(!window.WebGL2RenderingContext||!e.getContext("webgl2"))}catch(e){return!1}},v=d(e.BloomEffect,e.BlendFunction.SCREEN),h=d(e.BrightnessContrastEffect),E=r.forwardRef((function(t,n){var o=p(t,"offset"),i=r.useMemo((function(){return new e.ChromaticAberrationEffect(s.default({},t,{offset:o}))}),[o,t]);return a.default.createElement("primitive",{ref:n,object:i,dispose:null})})),x=r.forwardRef((function(t,n){var o=t.blendFunction,i=void 0===o?e.BlendFunction.NORMAL:o,u=r.useMemo((function(){return new e.ColorAverageEffect(i)}),[i]);return a.default.createElement("primitive",{ref:n,object:u,dispose:null})})),g=d(e.ColorDepthEffect),b=d(e.DepthEffect),w=r.createContext(null),S=a.default.memo(r.forwardRef((function(t,o){var i=t.children,c=t.camera,f=t.scene,s=t.renderPriority,d=void 0===s?1:s,p=t.depthBuffer,v=t.stencilBuffer,h=t.multisampling,E=void 0===h?8:h,x=t.frameBufferType,g=void 0===x?n.HalfFloatType:x,b=t.shouldRender,S=void 0===b||b,y=u.useThree(),M=y.gl,R=y.scene,C=y.camera,A=y.size;f=f||R,c=c||C;var L=r.useMemo((function(){var t=new e.EffectComposer(M,{depthBuffer:p,stencilBuffer:v,multisampling:m()?E:0,frameBufferType:g});t.addPass(new e.RenderPass(f,c));var r=new e.NormalPass(f,c);return t.addPass(r),[t,r]}),[c,M,p,v,E,g,f]),T=L[0],B=L[1];r.useEffect((function(){return null==T?void 0:T.setSize(A.width,A.height)}),[T,A]),u.useFrame((function(e,t){S&&T.render(t)}),d);var F=r.useRef();r.useEffect((function(){var t;return F.current&&T&&(t=l.default(e.EffectPass,[c].concat(F.current.__objects)),T.addPass(t),t.renderToScreen=!0),function(){t&&(null==T||T.removePass(t))}}),[T,c]);var P=r.useMemo((function(){return{composer:T,normalPass:B,camera:c,scene:f}}),[T,B,c,f]);return r.useImperativeHandle(o,(function(){return T}),[T]),a.default.createElement(w.Provider,{value:P},a.default.createElement("group",{ref:F},i))}))),y=r.forwardRef((function(t,o){var i=t.target,u=t.depthTexture,c=f.default(t,["target","depthTexture"]),s=r.useContext(w).camera,l=r.useMemo((function(){return new e.DepthOfFieldEffect(s,c)}),[s,c]);return r.useLayoutEffect((function(){if(i){var e=i instanceof n.Vector3?(new n.Vector3).set(i.x,i.y,i.z):(new n.Vector3).set(i[0],i[1],i[2]);l.target=e}u&&l.setDepthTexture(u.texture,u.packing)}),[i,u,l]),a.default.createElement("primitive",{ref:o,object:l,dispose:null})})),M=d(e.DotScreenEffect),R=r.forwardRef((function(t,n){var o=t.active,i=f.default(t,["active"]),u=p(i,"delay"),c=p(i,"duration"),l=p(i,"strength"),d=r.useMemo((function(){return new e.GlitchEffect(s.default({},i,{delay:u,duration:c,strength:l}))}),[u,c,i,l]);return r.useLayoutEffect((function(){d.mode=o?i.mode||e.GlitchMode.SPORADIC:e.GlitchMode.DISABLED}),[o,d,i.mode]),a.default.createElement("primitive",{ref:n,object:d,dispose:null})})),C=r.forwardRef((function(t,n){var o=r.useContext(w).camera,i=r.useMemo((function(){return new e.GodRaysEffect(o,t.sun,t)}),[o,t]);return a.default.createElement("primitive",{ref:n,object:i,dispose:null})})),A=r.forwardRef((function(t,n){var o=t.size,i=f.default(t,["size"]),u=r.useMemo((function(){return new e.GridEffect(i)}),[i]);return r.useLayoutEffect((function(){o&&u.setSize(o.width,o.height)}),[u,o]),a.default.createElement("primitive",{ref:n,object:u,dispose:null})})),L=d(e.HueSaturationEffect),T=d(e.NoiseEffect,e.BlendFunction.COLOR_DODGE),B=r.forwardRef((function(t,n){var o=t.selection,i=void 0===o?[]:o,u=t.selectionLayer,c=void 0===u?10:u,s=t.blendFunction,l=t.patternTexture,d=t.edgeStrength,p=t.pulseSpeed,m=t.visibleEdgeColor,v=t.hiddenEdgeColor,h=t.width,E=t.height,x=t.kernelSize,g=t.blur,b=t.xRay,S=(f.default(t,["selection","selectionLayer","blendFunction","patternTexture","edgeStrength","pulseSpeed","visibleEdgeColor","hiddenEdgeColor","width","height","kernelSize","blur","xRay"]),r.useContext(w)),y=S.scene,M=S.camera,R=r.useMemo((function(){return new e.OutlineEffect(y,M,{blendFunction:s,patternTexture:l,edgeStrength:d,pulseSpeed:p,visibleEdgeColor:m,hiddenEdgeColor:v,width:h,height:E,kernelSize:x,blur:g,xRay:b})}),[s,g,M,d,E,v,x,l,p,y,m,h,b]);return r.useEffect((function(){R.clearSelection(),R.setSelection(Array.isArray(i)?i.map((function(e){return e.current})):[i.current])}),[R,i]),r.useEffect((function(){R.selectionLayer=c}),[R,c]),a.default.createElement("primitive",{ref:n,object:R,dispose:null})})),F=r.forwardRef((function(t,n){var o=t.granularity,i=void 0===o?5:o,u=r.useMemo((function(){return new e.PixelationEffect(i)}),[i]);return a.default.createElement("primitive",{ref:n,object:u,dispose:null})})),P=d(e.ScanlineEffect,e.BlendFunction.OVERLAY),j=r.forwardRef((function(t,n){var o=t.selection,i=void 0===o?[]:o,u=t.selectionLayer,c=void 0===u?10:u,f=t.lights,s=void 0===f?[]:f,l=t.luminanceThreshold,d=t.luminanceSmoothing,p=t.intensity,m=t.width,v=t.height,h=t.kernelSize;0===s.length&&console.warn("SelectiveBloom requires lights to work.");var E=r.useContext(w),x=E.scene,g=E.camera,b=r.useMemo((function(){return new e.SelectiveBloomEffect(x,g,{blendFunction:e.BlendFunction.SCREEN,luminanceThreshold:l,luminanceSmoothing:d,intensity:p,width:m,height:v,kernelSize:h})}),[g,v,p,h,d,l,x,m]);return r.useEffect((function(){b.selection.set(Array.isArray(i)?i.map((function(e){return e.current})):[i.current])}),[b,i]),r.useEffect((function(){b.selection.layer=c}),[b,c]),r.useEffect((function(){return s.forEach((function(e){return function(e,t){e.current.layers.enable(t.selection.layer)}(e,b)})),function(){return s.forEach((function(e){return function(e,t){e.current.layers.disable(t.selection.layer)}(e,b)}))}}),[b,s,c]),a.default.createElement("primitive",{ref:n,object:b,dispose:null})})),D=d(e.SepiaEffect),O=r.forwardRef((function(t,n){var o=r.useContext(w),i=o.camera,u=o.normalPass,c=r.useMemo((function(){return new e.SSAOEffect(i,u.renderTarget.texture,s.default({blendFunction:e.BlendFunction.MULTIPLY,samples:30,rings:4,distanceThreshold:1,distanceFalloff:0,rangeThreshold:.5,rangeFalloff:.1,luminanceInfluence:.9,radius:20,scale:.5,bias:.5},t))}),[i,u.renderTarget.texture,t]);return a.default.createElement("primitive",{ref:n,object:c,dispose:null})})),G=r.forwardRef((function(t,n){var o=t.preset,i=void 0===o?e.SMAAPreset.HIGH:o,c=t.edgeDetectionMode,f=void 0===c?e.EdgeDetectionMode.COLOR:c,s=u.useLoader(e.SMAAImageLoader,""),d=r.useMemo((function(){return l.default(e.SMAAEffect,s.concat([i,f]))}),[s,i,f]);return a.default.createElement("primitive",{ref:n,object:d,dispose:null})})),z=r.forwardRef((function(t,o){var i=t.textureSrc,c=t.texture,l=f.default(t,["textureSrc","texture"]),d=u.useLoader(n.TextureLoader,i);r.useLayoutEffect((function(){d.encoding=n.sRGBEncoding,d.wrapS=d.wrapT=n.RepeatWrapping}),[d]);var p=r.useMemo((function(){return new e.TextureEffect(s.default({},l,{texture:d||c}))}),[l,d,c]);return a.default.createElement("primitive",{ref:o,object:p,dispose:null})})),V=d(e.ToneMappingEffect),q=d(e.VignetteEffect);exports.Bloom=v,exports.BrightnessContrast=h,exports.ChromaticAberration=E,exports.ColorAverage=x,exports.ColorDepth=g,exports.Depth=b,exports.DepthOfField=y,exports.DotScreen=M,exports.EffectComposer=S,exports.EffectComposerContext=w,exports.Glitch=R,exports.GodRays=C,exports.Grid=A,exports.HueSaturation=L,exports.Noise=T,exports.Outline=B,exports.Pixelation=F,exports.SMAA=G,exports.SSAO=O,exports.Scanline=P,exports.SelectiveBloom=j,exports.Sepia=D,exports.Texture=z,exports.ToneMapping=V,exports.Vignette=q,exports.isWebGL2Available=m,exports.useVector2=p,exports.wrapEffect=d;
